<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"openwares.net","root":"/","images":"/images","scheme":"Muse","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}};
  </script>
<meta name="description" content="open source and free matters">
<meta property="og:type" content="website">
<meta property="og:title" content="openwares.net">
<meta property="og:url" content="https://openwares.net/page/13/index.html">
<meta property="og:site_name" content="openwares.net">
<meta property="og:description" content="open source and free matters">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="changuoqiang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://openwares.net/page/13/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>
<title>openwares.net</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">openwares.net</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Freedom & Beauty</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">changuoqiang</p>
  <div class="site-description" itemprop="description">open source and free matters</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">981</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/12/22/gnome-alacarte-crash/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/12/22/gnome-alacarte-crash/" class="post-title-link" itemprop="url">gnome alacarte崩溃</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-12-22 16:44:55" itemprop="dateCreated datePublished" datetime="2018-12-22T16:44:55+08:00">2018-12-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>编辑菜单项时，alacarte突然崩溃，应该是因为wine生成的菜单有乱码导致的。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/12/22/gnome-alacarte-crash/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/12/11/macports-install-mypaint/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/12/11/macports-install-mypaint/" class="post-title-link" itemprop="url">macports安装mypaint</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-12-11 19:08:08" itemprop="dateCreated datePublished" datetime="2018-12-11T19:08:08+08:00">2018-12-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>brew没有打包mypaint，所以使用macports来安装</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/12/11/macports-install-mypaint/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/12/07/unzip-gbk-filename/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/12/07/unzip-gbk-filename/" class="post-title-link" itemprop="url">unzip解压缩中文名乱码问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-12-07 10:34:03" itemprop="dateCreated datePublished" datetime="2018-12-07T10:34:03+08:00">2018-12-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>windows平台生成的zip文件名是使用CP936也就是GBK编码的，导致这样的文件在linux平台utf-8环境下解压缩的时候文件名会成为乱码，这个问题由来已久，但并没有从zip那边有个根本性的解决方案。</p>
<p>可以使用python的zipfile模块来解决这个问题。</p>
<p>python3版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">import zipfile</span><br><span class="line"></span><br><span class="line">print(&quot;Processing File &quot; + sys.argv[1])</span><br><span class="line"></span><br><span class="line">file&#x3D;zipfile.ZipFile(sys.argv[1],&quot;r&quot;);</span><br><span class="line">for name in file.namelist():</span><br><span class="line">    utf8name&#x3D;name.encode(&#39;cp437&#39;).decode(&#39;cp936&#39;)</span><br><span class="line">    print(&quot;Extracting &quot; + utf8name)</span><br><span class="line">    pathname &#x3D; os.path.dirname(utf8name)</span><br><span class="line">    if not os.path.exists(pathname) and pathname!&#x3D; &quot;&quot;:</span><br><span class="line">        os.makedirs(pathname)</span><br><span class="line">    data &#x3D; file.read(name)</span><br><span class="line">    if not os.path.exists(utf8name):</span><br><span class="line">        fo &#x3D; open(utf8name, &quot;wb&quot;)</span><br><span class="line">        fo.write(data)</span><br><span class="line">        fo.close</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>

<p>因为zipfile把所有非utf-8编码格式的文件名都作为cp437进行处理，因此需要先还原回cp437，然后重新编码为cp936。</p>
<p>python版本见Reference[1]。</p>
<p>References:</p>
<p>[1]<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/72bb8d2ed4df">Linux 下 zip 文件解压乱码解决方案</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/12/06/apt-install-package-versioned/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/12/06/apt-install-package-versioned/" class="post-title-link" itemprop="url">apt安装软件包指定版本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-12-06 08:59:08" itemprop="dateCreated datePublished" datetime="2018-12-06T08:59:08+08:00">2018-12-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/GNU-Linux/" itemprop="url" rel="index"><span itemprop="name">GNU/Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <a id="more"></a>
<p>当配置了多个源，特别是添加backports源之后，一个package可能有多个候选版本<br>源是有优先级的，apt会默认从优先级高的源安装package</p>
<p>可以通过apt-cache来查看package候选版本信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ apt-cache policy tmux</span><br><span class="line">tmux:</span><br><span class="line"> Installed: (none)</span><br><span class="line"> Candidate: <span class="number">2.3</span>-<span class="number">4</span></span><br><span class="line"> Version table:</span><br><span class="line"> <span class="number">2.8</span>-<span class="number">1</span>~bpo9+<span class="number">1</span> <span class="number">100</span></span><br><span class="line"> <span class="number">100</span> http:<span class="comment">//ftp.tw.debian.org/debian stretch-backports/main amd64 Packages</span></span><br><span class="line"> <span class="number">2.3</span>-<span class="number">4</span> <span class="number">500</span></span><br><span class="line"> <span class="number">500</span> http:<span class="comment">//ftp.tw.debian.org/debian stretch/main amd64 Packages</span></span><br></pre></td></tr></table></figure>
<p>可以看到backports源优先级比较低，所以默认安装并不会安装最新版本</p>
<p>可以通过指定版本来安装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install tmux=<span class="number">2.8</span>-<span class="number">1</span>~bpo9+<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>bpo就是backports的缩写，</p>
<p>或者指定从backports源里安装：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install tmux -t stretch-backports</span><br></pre></td></tr></table></figure>

<p>还可以查看源里多个版本的详细信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ apt-cache show tmux</span><br><span class="line">Package: tmux</span><br><span class="line">Version: <span class="number">2.8</span>-<span class="number">1</span>~bpo9+<span class="number">1</span></span><br><span class="line">Installed-Size: <span class="number">677</span></span><br><span class="line">...</span><br><span class="line">Package: tmux</span><br><span class="line">Version: <span class="number">2.3</span>-<span class="number">4</span></span><br><span class="line">Installed-Size: <span class="number">620</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/12/02/cassandra-rebuild-seed-node/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/12/02/cassandra-rebuild-seed-node/" class="post-title-link" itemprop="url">cassandra rebuild 种子节点</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-12-02 11:49:55" itemprop="dateCreated datePublished" datetime="2018-12-02T11:49:55+08:00">2018-12-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-10 18:01:58" itemprop="dateModified" datetime="2021-06-10T18:01:58+08:00">2021-06-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/GNU-Linux/" itemprop="url" rel="index"><span itemprop="name">GNU/Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <a id="more"></a>
<p>cassandra 2.2.6环境，有一台种子节点硬件故障，半年以后才修复重新上线。<br>其数据已经落后太多，而cassandra并不会在其重新上线后自动进行数据同步。<br>nodetool repair应该可以使其数据重新同步，但是那速度是无法忍受的，因此使用nodetool rebuild来重建其数据。</p>
<p>首先停止cassandra服务</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl stop cassandra</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service cassandra stop</span><br></pre></td></tr></table></figure>

<p>然后删除掉数据目录下system和用户keyspace的所有数据<br> $ sudo rm -rf /var/lib/cassandra/data/system/*<br>$ sudo rm -rf /var/lib/cassandra/data/your_keyspaces/* </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rm -rf /<span class="keyword">var</span>/lib/cassandra<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>如果不清除用户的keyspace，rebuild的时候并不会自动清除，而且rebuild是全量而不是增量，所以那些数据会成为垃圾数据，如果数据量很大，应该提前清除掉。</p>
<p>对于种子节点，还应该确认auto_bootstrap参数已经设置为false。</p>
<p>启动cassandra服务，执行rebuild</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service cassandra start</span><br><span class="line">$ nodetool rebuild -- name_of_existing_data_center</span><br></pre></td></tr></table></figure>

<p>指定源数据中心时，要指定与当前节点所在数据中心不同的数据中心。</p>
<p>查看rebuild进度</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n <span class="number">10</span> <span class="string">&#x27;nodetool netstats | grep &quot;Receiving\|Sending&quot; | gawk &#123;&#x27;</span><span class="string">&quot;&#x27;&quot;</span><span class="string">&#x27; print $1&quot; - &quot;$11/$4*100&quot;% Complete, &quot;($4-$11)/1024/1024/1024&quot; GB remaining&quot; &#x27;</span><span class="string">&quot;&#x27;&quot;</span><span class="string">&#x27;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>等nodetool rebuild结束重建就算完成了，其实这与添加新的节点差别不大,不过就是原来的环境，所有的配置都不用动罢了。</p>
<p>同步完成后可以看看用户表的统计信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nodetool tablestats keyspace_name.table_name</span><br></pre></td></tr></table></figure>

<p><strong>updated:06/22/2019</strong></p>
<p>这次种子节点下线重做RAID，系统重新安装，cassandra版本为2.2.14</p>
<p>rebuild的时候提示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$nodetool rebuild -- DC2</span><br><span class="line"></span><br><span class="line">nodetool: Unable to find sufficient sources <span class="keyword">for</span> streaming range (<span class="number">2952258499581076301</span>,<span class="number">2996932853512195336</span>\] <span class="keyword">in</span> keyspace system_traces</span><br><span class="line">See <span class="string">&#x27;nodetool help&#x27;</span> or <span class="string">&#x27;nodetool help &lt;command&gt;&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>需要将keyspace system_traces的replication strategy设置为NetworkTopologyStrategy并将其分布到所有的数据中心，其默认设置为SimpleStrategy</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cqlsh&gt; ALTER KEYSPACE system_traces WITH replication = &#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;NetworkTopologyStrategy&#x27;</span>, <span class="string">&#x27;DC1&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;DC2&#x27;</span>:<span class="number">1</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>keyspace system_distributed的replication strategy也应该设置为NetworkTopologyStrategy并将其分布到所有的数据中心</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cqlsh&gt; ALTER KEYSPACE system_distributed WITH replication = &#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;NetworkTopologyStrategy&#x27;</span>, <span class="string">&#x27;DC1&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;DC2&#x27;</span>:<span class="number">1</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>References:<br>[1]<a target="_blank" rel="noopener" href="https://support.datastax.com/hc/en-us/articles/213145066-Unable-to-find-sufficient-sources-for-streaming-range-token-a-token-b-in-keyspace-some-keyspace-">Unable to find sufficient sources for streaming range (,] in keyspace</a><br>[2]<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/46723429/unable-to-find-sufficient-sources-for-streaming-range-in-keyspace">Unable to find sufficient sources for streaming range in keyspace</a><br>[3]<a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/CASSANDRA-11098">system_distributed and system_traces keyspaces use hard-coded replication factors</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/11/30/remove-unused-function-code-from-c-sourcecode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/30/remove-unused-function-code-from-c-sourcecode/" class="post-title-link" itemprop="url">移除C语言源代码中未被使用的函数/代码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-30 18:15:56" itemprop="dateCreated datePublished" datetime="2018-11-30T18:15:56+08:00">2018-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/GNU-Linux/" itemprop="url" rel="index"><span itemprop="name">GNU/Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <a id="more"></a>
<p>怎么找到C源程序中没有被引用的function/死代码?<br>GCC的CFLAGS -Wall -Wextra只能报告未使用的变量，而函数要到代码全部链接完成，才能知道哪些是没有被任何代码引用的，为时已晚。</p>
<p>在编译链接时可以组合使用CFLAGS: -ffunction-sections -fdata-sections 和 LDFLAGS: -Wl,-gc-sections在目标文件里移除未使用的代码，那么如何在源文件里找到这些函数呢？</p>
<p>一个相当简单的办法，编译完成后，对比ELF目标文件和所有obj对象文件中符号表中符号的差异，就这一知道哪些函数在最终的目标文件中被移除了，也就是无用的函数。</p>
<p>首先编译代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cc foo.c -o foo -fdata-sections -ffunction-sections -Wl,--gc-sections -save-temps</span><br></pre></td></tr></table></figure>

<p>注意要使用参数-save-temps保留中间文件，要用到是*.o对象文件<br>注意要保留符号表，不要strip all<br>gcc的<code>--gc-sections</code>在clang中对应的是<code>-dead_strip</code></p>
<p>然后使用这个脚本<a target="_blank" rel="noopener" href="https://github.com/PetersSharp/C-code---Find-Unused-functions/blob/master/find-unused-function.sh">find-unused-function.sh</a>通过比较符号表找出从未被使用的函数名字</p>
<p>在工程目录下执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./find-unused-<span class="keyword">function</span>.sh foo .</span><br></pre></td></tr></table></figure>

<p>生成的./DebugSymbol/symbols.unused-binary文件中记载了未被使用的函数名称。</p>
<p>References:<br>[1]<a target="_blank" rel="noopener" href="https://github.com/PetersSharp/C-code---Find-Unused-functions">C-code—Find-Unused-functions</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/11/30/gcc-remove-unused-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/30/gcc-remove-unused-code/" class="post-title-link" itemprop="url">GCC编译链接时移除未使用的代码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-30 10:45:50" itemprop="dateCreated datePublished" datetime="2018-11-30T10:45:50+08:00">2018-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/GNU-Linux/" itemprop="url" rel="index"><span itemprop="name">GNU/Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <a id="more"></a>
<p>编译时把数据和函数放到单独的section中，然后链接的时候抛弃掉未使用的section就可以了。</p>
<p>也就是组合使用CFLAGS: <code>-ffunction-sections -fdata-sections</code> 和 LDFLAGS: <code>-Wl,--gc-sections</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cc foo.c -o foo -Os -fdata-sections -ffunction-sections -Wl,--gc-sections -s</span><br></pre></td></tr></table></figure>

<p>-s 选项剥离掉调试信息，可以进一步减小目标文件的尺寸。</p>
<p>References:<br>[1]<a target="_blank" rel="noopener" href="https://embeddedfreak.wordpress.com/2009/02/10/removing-unused-functionsdead-codes-with-gccgnu-ld/">Removing Unused Functions/Dead Codes with GCC/GNU-ld</a><br>[2]<a target="_blank" rel="noopener" href="http://gcc.gnu.org/ml/gcc-help/2003-08/msg00128.html">Re: Removing unused functions/dead code</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/11/29/webassembly-cwrap-bigstring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/29/webassembly-cwrap-bigstring/" class="post-title-link" itemprop="url">WebAssembly cwrap无法传递大字符串问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-29 22:57:23" itemprop="dateCreated datePublished" datetime="2018-11-29T22:57:23+08:00">2018-11-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <a id="more"></a>
<p>当用很大的字符串调用cwrap包装的wasm函数时，出现如下错误：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stack overflow! Attempted to allocate <span class="number">8588685</span> bytes on the stack, but stack has only <span class="number">5242877</span> bytes available!</span><br></pre></td></tr></table></figure>

<p>这是数据太大，把栈撑爆了。cwrap使用stack来传递临时数据，只能拷贝数据，不支持引用传递，不支持自动扩展，并且，stack上的数据是临时的，被调用的代码如果保存通过stack传递进来的指针以备后用，有可能会引用到无效的数据，这是不安全的。<br>所以这样来传递大量数据是不妥当的，应该使用WebAssembly模块的heap来传递这样的大字符串。</p>
<p>官方文档是这样说的：<br>cwrap uses the C stack for temporary values. If you pass a string then it is only “alive” until the call is complete. If the code being called saves the pointer to be used later, it may point to invalid data. If you need a string to live forever, you can create it, for example, using _malloc and stringToUTF8(). However, you must later delete it manually!</p>
<p>可以使用Module._malloc()和Module.stringToUTF8()函数通过heap来传递大量数据：<br>[cpp]<br>const bufferSize = Module.lengthBytesUTF8(veryLargeString) + 1;<br>const bufferPtr = Module._malloc(bufferSize);<br>Module.stringToUTF8(veryLargeString, bufferPtr, bufferSize);<br>const sample = Module.cwrap(‘sample’, null, [‘number’]); // not ‘string’, pointer is a number<br>sample(bufferPtr);<br>Module._free(bufferPtr);<br>[/cpp]</p>
<p>要注意Module.lengthBytesUTF8给出的长度并不包括空终结符，所以缓冲区大小要再加1。被调用的函数不再使用string类型的参数，而改用number类型，因为指针就是一个number。分配的缓冲区使用完之后记得要free掉，不然会造成内存泄露。</p>
<p>为了确保heap能自动增长，build模块时应该添加-s ALLOW_MEMORY_GROWTH=1参数，就不用害怕传递大型参数了。</p>
<p>还有一个更简洁的包装方法allocateUTF8可用，直接传递给它数据，它就可以将数据拷贝到堆上，并返回在heap上分配的空间地址，这样用：<br>[cpp]<br>const bufferPtr = allocateUTF8(veryLargeString);<br>const sample = Module.cwrap(‘sample’, null, [‘number’]); // not ‘string’, pointer is a number<br>sample(bufferPtr);<br>Module._free(bufferPtr);<br>[/cpp]</p>
<p>allocateUTF8的源代码：<br>[javascript]<br>// Allocate heap space for a JS string, and write it there.<br>// It is the responsibility of the caller to free() that memory.<br>function allocateUTF8(str) {<br> var size = lengthBytesUTF8(str) + 1;<br> var ret = _malloc(size);<br> if (ret) stringToUTF8Array(str, HEAP8, ret, size);<br> return ret;<br>}<br>[/javascript]</p>
<p>wasm模块可以从emscripten HEAP上返回字符串，只要给javascript传回一个空终结UTF8编码的字符串指针就可以了：</p>
<p>[javascript]<br>// Given a pointer ‘ptr’ to a null-terminated UTF8-encoded string in the emscripten HEAP, returns<br>// a copy of that string as a Javascript String object.</p>
<p>function UTF8ToString(ptr) {<br> return UTF8ArrayToString(HEAPU8,ptr);<br>}<br>[/javascript]</p>
<p><strong>最后</strong>：</p>
<p>其实stack和heap都分配自WebAssembly.memory对象，这是一个ArrayBuffer对象，可以使用不同的视图来存取。stack和heap的区别是使用和管理内存的方式不同。<br>调用instance.exports._malloc时是调用的是C/C++标准库的malloc函数，而emscripten实现的malloc函数正是在WebAssembly.memory上动态分配内存。</p>
<p>References:<br>[1]<a target="_blank" rel="noopener" href="https://github.com/kripken/emscripten/issues/6860">Stack overflow error when large string passed</a><br>[2]<a target="_blank" rel="noopener" href="https://github.com/kripken/emscripten/issues/4344">Automatically growing the stack</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/11/28/twentyseventeen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/28/twentyseventeen/" class="post-title-link" itemprop="url">twentyseventeen</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-28 14:57:54" itemprop="dateCreated datePublished" datetime="2018-11-28T14:57:54+08:00">2018-11-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>.wrap {<br>/* margin-left: auto; <em>/<br>/</em> margin-right: auto; <em>/<br>max-width: 100%;<br>/</em> padding-left: 2em; <em>/<br>/</em> padding-right: 2em; */<br>}</p>
<p>@media screen and (min-width: 48em) {<br>.wrap {<br>max-width: 100%;<br>/* padding-left: 3em; <em>/<br>/</em> padding-right: 3em; */<br>}<br>}</p>
<p>.page.page-one-column:not(.twentyseventeen-front-page) #primary {<br>/<em>margin-left: auto;</em>/<br>/<em>margin-right: auto;</em>/<br>max-width: 100%;<br>}</p>
<p>@media screen and (min-width: 30em) {<br>.page-one-column .panel-content .wrap<br>{<br>max-width: 100%;<br>}<br>}</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://openwares.net/2018/11/28/flatpak-intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="changuoqiang">
      <meta itemprop="description" content="open source and free matters">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="openwares.net">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/11/28/flatpak-intro/" class="post-title-link" itemprop="url">flatpak简单介绍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-28 14:11:49" itemprop="dateCreated datePublished" datetime="2018-11-28T14:11:49+08:00">2018-11-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-04 20:01:09" itemprop="dateModified" datetime="2020-12-04T20:01:09+08:00">2020-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/GNU-Linux/" itemprop="url" rel="index"><span itemprop="name">GNU/Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <a id="more"></a>
<p>GIMP改用flatpak打包，flatpak以前叫xdg-app，现在flatpak是指flat package吗?</p>
<p>flatpak是一种致力于减少依赖的通用应用打包格式，与之竞争的还有snap和AppImage</p>
<p><strong>安装</strong></p>
<p>flatpak已经进入debian当前的testing buster源和sid源， debian stretch可以从官方的backports源<code>deb http://ftp.tw.debian.org/debian stretch-backports main contrib non-free</code>安装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt install flatpak</span><br></pre></td></tr></table></figure>

<p>添加flatpak官方源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo flatpak remote-add --<span class="keyword">if</span>-not-exists flathub https:<span class="comment">//flathub.org/repo/flathub.flatpakrepo</span></span><br></pre></td></tr></table></figure>

<p>因为flatpak本身就是一种app打包格式，官方应该提供一个自举安装的shell脚本才显得更专业:)</p>
<p><strong>安装gimp</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ flatpak install https:<span class="comment">//flathub.org/repo/appstream/org.gimp.GIMP.flatpakref</span></span><br></pre></td></tr></table></figure>

<p>可以使用桌面图标运行，或者使用以下命令：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ flatpak run org.gimp.GIMP<span class="comment">//stable</span></span><br></pre></td></tr></table></figure>

<p><strong>flatpak文件系统布局</strong></p>
<p>flatpak支持系统范围安装和用户安装，系统安装在/var/lib/flatpak,<br>安装的app系统配置在/var/lib/flatpak/app，其他子目录为flatpak本身系统范围的配置<br>安装的app的当前用户配置在$HOME/.var/app，flatpak本身的当前用户配置在$HOME/.local/share/flatpak</p>
<p>References:<br>[1]<a target="_blank" rel="noopener" href="https://flatpak.org/">Flatpak</a><br>[2]<a target="_blank" rel="noopener" href="https://github.com/flatpak/flatpak/wiki/Filesystem">Flatpak filesystem layout</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/99/">99</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">changuoqiang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  

<script src="/js/local-search.js"></script>






  






</body>
</html>
